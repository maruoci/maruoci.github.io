---
title: JVM学习(一)：内存管理
date: 2018-10-17 22:55:30
categories:
- Java虚拟机
tags:
- Java
- Jvm
---

> 根据深入理解Java虚拟机摘抄一些JVM内存管理的一些重点。旨在深入理解Java中的内存区域划分。

**看完本节内容后，您应该弄懂以下几个问题：**

 1. 可以画出JVM运行时的数据区域图。
 2. 常规的JVM参数含义。
 3. Java数组在内存中的存储位置。

## 参考书籍

 **深入理解Java虚拟机（第二版）**
 
 <!--more-->
 
## JVM 运行时数据区域

<img src="http://pbsg2r9io.bkt.clouddn.com/18-8-6/99649423.jpg" style="display:block;margin:0px 0px"/>

**程序计数器（线程私有）**

 虚拟机多线程是由线程轮流切换分配CPU的执行权限，为了保证线程切换后能恢复到正确的执行位置，每条线程需要一个独立的程序计数器。
 
 > 如果线程正在执行的是一个Java方法，这个计数器记录的是正在执行的虚拟机字节码指令的地址；  
 > 如果正在执行的是Native方法，这个计数器值则为空（Undefined）。  
 > 此内存区域是唯一一个在Java虚拟机规范中没有规定任何OutOfMemoryError情况的区域。

**虚拟机栈（线程私有）**

 常说的栈内存就是指的虚拟机栈，或者说是虚拟机栈中局部变量表部分。
 
 虚拟机栈描述java方法执行的内存模型，每个方法执行的同时会创建栈帧，用于存储局部变量表，操作数栈，动态链接，方法出口等信息。每一个方法调用从开始到结束对应着一个栈帧在虚拟机栈中从入栈到出栈的过程。
 
 > 局部变量表：存储编译期可知的各种基本数据类型、对象引用。
 > 虚拟机栈中定义了两种异常，当栈深度大于虚拟机所允许的深度(StackOverflowError)，栈扩展时无法申请足够内存(OutOfMemoryError)。
 
 
**本地方法栈（线程私有）**
 
 本地方法栈和虚拟机栈类似，区别在于本地方法栈执行的是Native方法。虚拟机规范对Native方法所使用的语言、方式和数据结构没有强制规定。
 
**Java堆（线程共享）**

 堆是Java虚拟机管理的内存中最大的一块，是所有线程共享的一块内存区域。虚拟机启动时创建该区域，用于存放所有对象实例。
 
 所有对象实例和数组都在堆上分配。

 > 当堆中没有可用内存时抛出(OutOfMemoryError)
 
**方法区（线程共享）**

 方法区存储被虚拟机加载的类信息、常量、静态变量、即时编译器编译后的代码等信息。
 
 > HotSpot虚拟机开发者也常把方法区称做”永久代“。是因为HotSpot使用永久代来实现方法区。目前正逐步放弃该实现。 
 > 方法区无法满足内存分配需求时，抛出(OutOfMemoryError)

**运行时常量池**

 方法区的一部分，编译期生成的各种字面量和符号引用 将存储在该区域。
 
 > 运行时常量池中的常量并非只有编译期才能产生。运行期也可以将新的常量放入常量池。如`String.intern`

**直接内存**

 NIO基于通道和缓冲区的I/O方式，使用Native函数库可以直接分配堆外内存。

 > 直接内存的分配不受堆内存限制。
 
## 总结 